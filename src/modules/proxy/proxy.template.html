<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Template</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>

<div class="container my-5">
  <form data-testid="our-proxy-form">
    <div class="form-group">
      <label for="url">URL</label>
      <input data-testid="url-input" type="text" class="form-control" id="url" placeholder="Enter URL">
      <small id="url-help" class="form-text text-muted">Make sure the address is correct, for example https://google.pl</small>
    </div>
    <button type="submit" class="btn btn-primary">Open</button>
  </form>
</div>

<script>
  const form = document.querySelector('form')
  let lastOpenedWindow;

  form.addEventListener('submit', (e) => {
    e.preventDefault()

    if (lastOpenedWindow) {
      lastOpenedWindow.close()
    }

    const { value } = e.target.url
    const encodeValue = window.btoa(value)

    document.cookie = `proxy-url = ${encodeValue}`

    e.target.reset()
    lastOpenedWindow = window.open('/')
  })
</script>
</body>
</html>
